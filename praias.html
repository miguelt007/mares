<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Mapa de Praias com PrevisÃ£o</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 100vh; }
    .popup-content { font-size: 14px; }
    .dados-box { margin-top: 10px; font-size: 13px; }
    button { margin-top: 5px; padding: 5px; font-size: 13px; cursor: pointer; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const apiKey = '3cbe21f4-75eb-11f0-8df7-0242ac130006-3cbe2258-75eb-11f0-8df7-0242ac130006'; // ğŸ”‘ Insere aqui a tua chave da Stormglass

    const praias = [
      {
        nome: "Praia da NazarÃ©",
        latitude: 39.602,
        longitude: -9.070,
        municipio: "NazarÃ©",
        regiao: "Centro",
        tipo: "OceÃ¢nica",
        bandeiraAzul: true
      },
      {
        nome: "Praia de Carcavelos",
        latitude: 38.676,
        longitude: -9.325,
        municipio: "Cascais",
        regiao: "Lisboa",
        tipo: "OceÃ¢nica",
        bandeiraAzul: true
      }
    ];

    const map = L.map('map').setView([39.5, -8.5], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    function mostrarPraias() {
      praias.forEach(praia => {
        const marker = L.marker([praia.latitude, praia.longitude]).addTo(map);
        marker.bindPopup(`
          <div class="popup-content" id="popup-${praia.nome.replace(/\s+/g, '')}">
            <strong>${praia.nome}</strong><br>
            ${praia.municipio}, ${praia.regiao}<br>
            Tipo: ${praia.tipo}<br>
            Bandeira Azul: ${praia.bandeiraAzul ? 'âœ…' : 'âŒ'}<br>
            <button onclick="verPrevisao(${praia.latitude}, ${praia.longitude}, '${praia.nome}')">Ver PrevisÃ£o</button>
          </div>
        `);
      });
    }

    async function verPrevisao(lat, lng, nome) {
      const params = 'waveHeight,airTemperature,waterTemperature,windSpeed';
      const now = new Date();
      const end = new Date();
      end.setDate(now.getDate() + 3);

      const url = `https://api.stormglass.io/v2/weather/point?lat=${lat}&lng=${lng}&params=${params}&start=${now.toISOString()}&end=${end.toISOString()}`;

      try {
        const response = await fetch(url, {
          headers: { Authorization: apiKey }
        });
        const data = await response.json();

        let html = `<div class="dados-box"><strong>ğŸŒ¤ï¸ PrevisÃ£o 3 dias</strong><br>`;
        const dias = {};

        data.hours.forEach(hour => {
          const dia = new Date(hour.time).toLocaleDateString();
          if (!dias[dia]) dias[dia] = hour;
        });

        Object.entries(dias).forEach(([dia, info]) => {
          html += `
            <hr><strong>ğŸ“… ${dia}</strong><br>
            ğŸŒŠ Ondas: ${info.waveHeight?.noaa ?? 'N/D'} m<br>
            ğŸ’¨ Vento: ${info.windSpeed?.noaa ?? 'N/D'} m/s<br>
            ğŸŒ¡ï¸ Ar: ${info.airTemperature?.noaa ?? 'N/D'} Â°C<br>
            ğŸŒŠ Ãgua: ${info.waterTemperature?.noaa ?? 'N/D'} Â°C<br>
          `;
        });

        html += `</div>`;
        const popupId = `popup-${nome.replace(/\s+/g, '')}`;
        const popupElement = document.getElementById(popupId);
        if (popupElement) popupElement.innerHTML += html;
      } catch (err) {
        alert('Erro ao obter dados marÃ­timos.');
        console.error(err);
      }
    }

    mostrarPraias();
  </script>
</body>
</html>
